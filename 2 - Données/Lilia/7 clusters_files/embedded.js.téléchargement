!function(){"use strict";var e,t;function n(){if(null==e){var t=function(){var e=window.location;"about:srcdoc"==e.href&&(e=window.parent.location);var t={};return function(e,n,i){for(;i=n.exec(e);)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2])}(e.search.substring(1).replace(/\+/g,"%20"),/([^&=]+)=?([^&]*)/g),t}();e="referrer"in t?/^https:\/\/medium.com\//.test(t.referrer):!("auto"in t)}return e}function i(e){var t=e||window.innerWidth;return t>999?650:t>599?575:400}function o(e,n){if(window.top!==window.self){var i=window;if("srcdoc"==i.location.pathname&&(i=i.parent),t)return e=parseInt(e,10),void i.parent.postMessage({sentinel:"amp",type:"embed-size",height:e},"*");var o={sender:"Flourish",context:"iframe.resize",method:"resize",height:e,src:i.location.toString()};if(n)for(var r in n)o[r]=n[r];i.parent.postMessage(JSON.stringify(o),"*")}}function r(){return(-1!==navigator.userAgent.indexOf("Safari")||-1!==navigator.userAgent.indexOf("iPhone"))&&-1==navigator.userAgent.indexOf("Chrome")}function a(e){window.addEventListener("message",(function(t){if(null!=t.source&&(t.origin===document.location.origin||t.origin.match(/\/\/localhost:\d+$|\/\/flourish-api\.com$|\.flourish\.(?:local(:\d+)?|net|rocks|studio)$|\.uri\.sh$/))){var n;try{n=JSON.parse(t.data)}catch(e){return void console.warn("Unexpected non-JSON message: "+JSON.stringify(t.data))}if("Flourish"===n.sender){for(var i=document.querySelectorAll("iframe"),o=0;o<i.length;o++)if(i[o].contentWindow==t.source||i[o].contentWindow==t.source.parent)return void e(n,i[o]);console.warn("could not find frame",n)}}})),r()&&(window.addEventListener("resize",s),s())}function s(){for(var e=document.querySelectorAll(".flourish-embed"),t=0;t<e.length;t++){var n=e[t];if(!n.getAttribute("data-width")){var i=n.querySelector("iframe"),o=window.getComputedStyle(n),r=n.offsetWidth-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight);i.style.width=r+"px"}}}function d(e,t,n,o){var a;n&&"number"==typeof n?(a=n,n+="px"):n&&n.match(/^[ \t\r\n\f]*([+-]?\d+|\d*\.\d+(?:[eE][+-]?\d+)?)(?:\\?[Pp]|\\0{0,4}[57]0(?:\r\n|[ \t\r\n\f])?)(?:\\?[Xx]|\\0{0,4}[57]8(?:\r\n|[ \t\r\n\f])?)[ \t\r\n\f]*$/)&&(a=parseFloat(n)),o&&"number"==typeof o&&(o+="px");var s=document.createElement("iframe");return s.setAttribute("scrolling","no"),s.setAttribute("frameborder","0"),s.setAttribute("title","Interactive or visual content"),s.setAttribute("sandbox","allow-same-origin allow-forms allow-scripts allow-downloads allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation"),t.appendChild(s),n?s.style.width=n:r()?s.style.width=t.offsetWidth+"px":s.style.width="100%",!!o||(e.match(/\?/)?e+="&auto=1":e+="?auto=1",o=i(a||s.offsetWidth)+"px"),o&&("%"===o.charAt(o.length-1)&&(o=parseFloat(o)/100*t.parentNode.offsetHeight+"px"),s.style.height=o),s.setAttribute("src",e),s}!function(){var e,s=window.top===window.self,l=s?null:(t="#amp=1"==window.location.hash,{createEmbedIframe:d,isFixedHeight:n,getHeightForBreakpoint:i,startEventListeners:a,notifyParentWindow:o,isSafari:r}),u=!0;function f(){var t;Flourish.fixed_height||(null!=e?t=e:u&&(t=l.getHeightForBreakpoint()),t!==window.innerHeight&&l.notifyParentWindow(t))}function h(){f(),window.addEventListener("resize",f)}Flourish.warn=function(e){if("string"==typeof e&&(e={message:e}),s||"editor"!==Flourish.environment)console.warn(e.message);else{var t={sender:"Flourish",method:"warn",message:e.message,explanation:e.explanation};window.parent.postMessage(JSON.stringify(t),"*")}},Flourish.uploadImage=function(e){if(s||"story_editor"!==Flourish.environment)throw"Invalid upload request";var t={sender:"Flourish",method:"request-upload",name:e.name,accept:e.accept};window.parent.postMessage(JSON.stringify(t),"*")},Flourish.setHeight=function(t){Flourish.fixed_height||(e=t,u=null==t,f())},Flourish.checkHeight=function(){if(!s){var e=Flourish.__container_height;null!=e?(Flourish.fixed_height=!0,l.notifyParentWindow(e)):l.isFixedHeight()?Flourish.fixed_height=!0:(Flourish.fixed_height=!1,f())}},Flourish.fixed_height=s||l.isFixedHeight(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}()}();
